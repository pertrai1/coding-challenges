name: Claude Code Review
on:
  pull_request:
    types: [opened, synchronize, ready_for_review, reopened]

permissions:
  contents: read
  pull-requests: write
  issues: write

jobs:
  review:
    runs-on: ubuntu-latest
    if: github.actor == 'pertrai1'
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run Claude Code Review
        uses: anthropics/claude-code-action@v1
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ secrets.GITHUB_TOKEN }}
          track_progress: true

          prompt: |
            Review this PR as a DSA learning exercise. This repository is for practicing algorithmic problem-solving.

            CONTEXT:
            - REPO: ${{ github.repository }}
            - PR NUMBER: ${{ github.event.pull_request.number }}
            - Review according to guidelines in CLAUDE.md

            REVIEW CHECKLIST:
            1. ALGORITHM CORRECTNESS
               - Verify solution handles all edge cases
               - Test mental trace with the given examples
               - Identify any logical errors

            2. COMPLEXITY ANALYSIS
               - State the actual time complexity with explanation
               - State the actual space complexity with explanation
               - Compare to optimal solution if known
               - Flag any inaccuracies in code comments

            3. DSA LEARNING FOCUS
               - Name the algorithmic pattern(s) used (e.g., sliding window, two pointers, DP)
               - Explain WHY this pattern is suitable for this problem
               - Suggest 2-3 related LeetCode problems for practice
               - Mention common variations of this pattern
               - Provide a "Key Insight" - the non-obvious trick that makes this solution work

            4. CODE QUALITY
               - Variable naming clarity
               - Comment quality and accuracy
               - Best practices adherence

            5. ALTERNATIVE APPROACHES
               - Mention 1-2 alternative algorithms that could solve this
               - Explain trade-offs (time vs space, simplicity vs efficiency)

            Provide detailed inline comments for specific issues.
            End with a "Learning Summary" section highlighting key DSA concepts from this problem.

          claude_args: |
            --allowedTools "mcp__github_inline_comment__create_inline_comment,Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*)"
